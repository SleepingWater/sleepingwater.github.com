
// TODO: tests
// TODO: nested multipart
// TODO: multipart streaming
// TODO: plugins
// TODO: gunzip (plugin)
// TODO: abort
// TODO: redirect GET only (option?)
// TODO: public redirectsFollowed or w/e
// TODO: global handlers
// TODO: preventDefault() etc for ^
// TODO: keep-alive

/**
 * Module dependencies.
 */

var request = require('./')
  , express = require('express')
  , app = express.createServer()
  , formidable = require('formidable')
  , url = require('url')
  , fs = require('fs');

app.get('/', function(req, res){
  console.log('GET /');
  var n = 100;
  while (n--) res.write(String(n));
  res.end();
});

app.post('/form', function(req, res){
  var form = new formidable.IncomingForm;
  form.parse(req, function(err, fields, files){
    if (err) throw err;
    console.log(fields);
    console.log(files);
    res.send('yay');
  });
});

app.post('/user', function(req, res){
  req.on('data', function(chunk){
    console.log(chunk.toString());
  });
  req.on('end', function(){
    console.log('<<<end>>>');
  });
});

app.listen(3000);

var req = request.post('/user');
req.on('end', function(){
  console.log('response');
});

var stream = fs.createReadStream('package.json');
stream.pipe(req);
stream.on('end', function(){
  req.end();
  console.log('stream end');
});

// var req = request.post('/form');
// 
// // var part = req.part()
//   // .set('Content-Type', 'application/js');
// 
// fs.createReadStream('test.js')
//   .pipe(req);
// 
// // part.on('end', function(){
//   // console.log('part ended');
// // });
// 
// req.on('end', function(){
//   console.log('req ended');
// });

// request
//   .post('/form')
//   .type('multipart/mixed; boundary=luna')
//   .write('\r\n--luna\r\n')
//   .write('Content-Disposition: form-data; name="name"\r\n')
//   .write('\r\n')
//   .write('manny')
// 
//   .write('\r\n')
//   .write('--luna\r\n')
//   .write('Content-Disposition: form-data; name="age"\r\n')
//   .write('\r\n')
//   .write('1')
// 
//   .write('\r\n--luna--')
//   .end(function(err, res){
//     // if (err) throw err;
//     console.log(res.status); 
//     // console.log(res.text); 
//   });
